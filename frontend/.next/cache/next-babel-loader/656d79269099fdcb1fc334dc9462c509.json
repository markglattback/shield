{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"C:\\\\apps\\\\shield\\\\frontend\\\\lib\\\\withAuth.js\";\nimport React, { Component } from 'react';\nimport cookies from 'next-cookies';\nimport Router from 'next/router';\nimport composeQueryString from './composeQueryString'; // Gets the display name of a JSX component for dev tools\n\nvar getDisplayName = function getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n};\n\nvar _withAuth = function _withAuth(WrappedComponent) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    _inherits(withAuth, _Component);\n\n    function withAuth() {\n      var _getPrototypeOf2;\n\n      var _this;\n\n      _classCallCheck(this, withAuth);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(withAuth)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n      _defineProperty(_assertThisInitialized(_this), \"handleError\", function () {\n        if (typeof window !== 'undefined') {\n          Router.push('/login');\n        }\n      });\n\n      return _this;\n    }\n\n    _createClass(withAuth, [{\n      key: \"render\",\n      value: function render() {\n        return React.createElement(WrappedComponent, _extends({}, this.props, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 35\n          },\n          __self: this\n        }));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(ctx) {\n          var _cookies, token, asPath, componentProps;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _cookies = cookies(ctx), token = _cookies.token;\n                  asPath = ctx.asPath; // Server side only\n\n                  if (ctx.req && !token) {\n                    // redirect to login page if no token present\n                    ctx.res.writeHead(302, {\n                      Location: '/login'\n                    });\n                    ctx.res.end();\n                  }\n\n                  _context.t0 = WrappedComponent.getInitialProps;\n\n                  if (!_context.t0) {\n                    _context.next = 8;\n                    break;\n                  }\n\n                  _context.next = 7;\n                  return WrappedComponent.getInitialProps(ctx);\n\n                case 7:\n                  _context.t0 = _context.sent;\n\n                case 8:\n                  componentProps = _context.t0;\n                  return _context.abrupt(\"return\", _objectSpread({}, componentProps));\n\n                case 10:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return withAuth;\n  }(Component), _defineProperty(_class, \"displayname\", \"withAuth(\".concat(getDisplayName(WrappedComponent), \")\")), _temp;\n};\n\nexport default _withAuth;","map":{"version":3,"sources":["C:\\apps\\shield\\frontend\\lib\\withAuth.js"],"names":["React","Component","cookies","Router","composeQueryString","getDisplayName","WrappedComponent","displayName","name","_withAuth","window","push","props","ctx","token","asPath","req","res","writeHead","Location","end","getInitialProps","componentProps"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,OAAP,MAAoB,cAApB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,kBAAP,MAA+B,sBAA/B,C,CAEA;;AACA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAAC,gBAAgB;AAAA,SAAIA,gBAAgB,CAACC,WAAjB,IAAgCD,gBAAgB,CAACE,IAAjD,IAAyD,WAA7D;AAAA,CAAvC;;AAEA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAAAH,gBAAgB;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA,oEAmBlB,YAAM;AAClB,YAAI,OAAOI,MAAP,KAAkB,WAAtB,EAAmC;AACjCP,UAAAA,MAAM,CAACQ,IAAP,CAAY,QAAZ;AACD;AACF,OAvB+B;;AAAA;AAAA;;AAAA;AAAA;AAAA,+BAyBvB;AACP,eAAO,oBAAC,gBAAD,eAAsB,KAAKC,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAP;AACD;AA3B+B;AAAA;AAAA;AAAA;AAAA;AAAA,kDAGHC,GAHG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,6BAIZX,OAAO,CAACW,GAAD,CAJK,EAItBC,KAJsB,YAItBA,KAJsB;AAKtBC,kBAAAA,MALsB,GAKXF,GALW,CAKtBE,MALsB,EAO9B;;AACA,sBAAIF,GAAG,CAACG,GAAJ,IAAW,CAACF,KAAhB,EAAuB;AACrB;AACAD,oBAAAA,GAAG,CAACI,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,sBAAAA,QAAQ,EAAE;AAAZ,qBAAvB;AACAN,oBAAAA,GAAG,CAACI,GAAJ,CAAQG,GAAR;AACD;;AAZ6B,gCAcPd,gBAAgB,CAACe,eAdV;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAcmCf,gBAAgB,CAACe,eAAjB,CAAiCR,GAAjC,CAdnC;;AAAA;AAAA;;AAAA;AAcxBS,kBAAAA,cAdwB;AAAA,qEAgBlBA,cAhBkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,IAA2BrB,SAA3B,6DACCI,cAAc,CAACC,gBAAD,CADf;AAAA,CAAlC;;AA8BA,eAAeG,SAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport cookies from 'next-cookies';\r\nimport Router from 'next/router';\r\nimport composeQueryString from './composeQueryString';\r\n\r\n// Gets the display name of a JSX component for dev tools\r\nconst getDisplayName = WrappedComponent => WrappedComponent.displayName || WrappedComponent.name || 'Component';\r\n\r\nconst _withAuth = WrappedComponent => class withAuth extends Component {\r\n  static displayname = `withAuth(${getDisplayName(WrappedComponent)})`;\r\n\r\n  static async getInitialProps(ctx) {\r\n    const { token } = cookies(ctx);\r\n    const { asPath } = ctx;\r\n\r\n    // Server side only\r\n    if (ctx.req && !token) {\r\n      // redirect to login page if no token present\r\n      ctx.res.writeHead(302, { Location: '/login' });\r\n      ctx.res.end();\r\n    }\r\n\r\n    const componentProps = WrappedComponent.getInitialProps && await WrappedComponent.getInitialProps(ctx);\r\n\r\n    return { ...componentProps };\r\n  }\r\n\r\n  handleError = () => {\r\n    if (typeof window !== 'undefined') {\r\n      Router.push('/login');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <WrappedComponent {...this.props} />;\r\n  }\r\n};\r\n\r\nexport default _withAuth;\r\n"]},"metadata":{},"sourceType":"module"}