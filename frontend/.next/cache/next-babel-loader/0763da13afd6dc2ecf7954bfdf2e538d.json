{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"C:\\\\apps\\\\shield\\\\frontend\\\\lib\\\\withAuth.js\";\nimport React, { Component } from 'react';\nimport cookies from 'next-cookies'; // Gets the display name of a JSX component for dev tools\n\nvar getDisplayName = function getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n};\n\nvar _withAuth = function _withAuth(WrappedComponent) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    _inherits(withAuth, _Component);\n\n    function withAuth() {\n      _classCallCheck(this, withAuth);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(withAuth).apply(this, arguments));\n    }\n\n    _createClass(withAuth, [{\n      key: \"render\",\n      value: function render() {\n        return React.createElement(WrappedComponent, _extends({}, this.props, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 32\n          },\n          __self: this\n        }));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(ctx) {\n          var _cookies, jwt, componentProps;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _cookies = cookies(ctx), jwt = _cookies.jwt; // SSR auth check only takes place on initial page load\n\n                  /*\r\n                    Questions:\r\n                    What if token expires\r\n                    What if token is blacklisted\r\n                    \r\n                  */\n\n                  if (ctx.req && !jwt) {\n                    // redirect to login page if no jwt present\n                    ctx.res.writeHead(302, {\n                      Location: '/login'\n                    });\n                    ctx.res.end();\n                  }\n\n                  _context.t0 = WrappedComponent.getInitialProps;\n\n                  if (!_context.t0) {\n                    _context.next = 7;\n                    break;\n                  }\n\n                  _context.next = 6;\n                  return WrappedComponent.getInitialProps(ctx);\n\n                case 6:\n                  _context.t0 = _context.sent;\n\n                case 7:\n                  componentProps = _context.t0;\n                  return _context.abrupt(\"return\", _objectSpread({}, componentProps));\n\n                case 9:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return withAuth;\n  }(Component), _defineProperty(_class, \"displayname\", \"withAuth(\".concat(getDisplayName(WrappedComponent), \")\")), _temp;\n};\n\nexport default _withAuth;","map":{"version":3,"sources":["C:\\apps\\shield\\frontend\\lib\\withAuth.js"],"names":["React","Component","cookies","getDisplayName","WrappedComponent","displayName","name","_withAuth","props","ctx","jwt","req","res","writeHead","Location","end","getInitialProps","componentProps"],"mappings":";;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,OAAP,MAAoB,cAApB,C,CAEA;;AACA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAAC,gBAAgB;AAAA,SAAIA,gBAAgB,CAACC,WAAjB,IAAgCD,gBAAgB,CAACE,IAAjD,IAAyD,WAA7D;AAAA,CAAvC;;AAEA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAAAH,gBAAgB;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,+BAwBvB;AACP,eAAO,oBAAC,gBAAD,eAAsB,KAAKI,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAP;AACD;AA1B+B;AAAA;AAAA;AAAA;AAAA;AAAA,kDAGHC,GAHG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,6BAIdP,OAAO,CAACO,GAAD,CAJO,EAItBC,GAJsB,YAItBA,GAJsB,EAM9B;;AACA;;;;;;;AAMA,sBAAID,GAAG,CAACE,GAAJ,IAAW,CAACD,GAAhB,EAAqB;AACnB;AACAD,oBAAAA,GAAG,CAACG,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,sBAAAA,QAAQ,EAAE;AAAZ,qBAAvB;AACAL,oBAAAA,GAAG,CAACG,GAAJ,CAAQG,GAAR;AACD;;AAjB6B,gCAmBPX,gBAAgB,CAACY,eAnBV;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAmBmCZ,gBAAgB,CAACY,eAAjB,CAAiCP,GAAjC,CAnBnC;;AAAA;AAAA;;AAAA;AAmBxBQ,kBAAAA,cAnBwB;AAAA,qEAqBlBA,cArBkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,IAA2BhB,SAA3B,6DACCE,cAAc,CAACC,gBAAD,CADf;AAAA,CAAlC;;AA6BA,eAAeG,SAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport cookies from 'next-cookies';\r\n\r\n// Gets the display name of a JSX component for dev tools\r\nconst getDisplayName = WrappedComponent => WrappedComponent.displayName || WrappedComponent.name || 'Component';\r\n\r\nconst _withAuth = WrappedComponent => class withAuth extends Component {\r\n  static displayname = `withAuth(${getDisplayName(WrappedComponent)})`;\r\n\r\n  static async getInitialProps(ctx) {\r\n    const { jwt } = cookies(ctx);\r\n\r\n    // SSR auth check only takes place on initial page load\r\n    /*\r\n      Questions:\r\n      What if token expires\r\n      What if token is blacklisted\r\n      \r\n    */\r\n    if (ctx.req && !jwt) {\r\n      // redirect to login page if no jwt present\r\n      ctx.res.writeHead(302, { Location: '/login' });\r\n      ctx.res.end();\r\n    }\r\n\r\n    const componentProps = WrappedComponent.getInitialProps && await WrappedComponent.getInitialProps(ctx);\r\n\r\n    return { ...componentProps };\r\n  }\r\n    \r\n  render() {\r\n    return <WrappedComponent {...this.props} />;\r\n  }\r\n};\r\n\r\nexport default _withAuth;\r\n"]},"metadata":{},"sourceType":"module"}